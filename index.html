<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Tracker</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3B82F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Monthly Tracker">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMzQjgyRjYiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjZmZmZmZmIj4KICA8cGF0aCBkPSJNMTIgMkM2LjQ4IDIgMiA2LjQ4IDIgMTJzNC40OCAxMCAxMCAxMCAxMC00LjQ4IDEwLTEwUzE3LjUyIDIgMTIgMnptLTIgMTVsLTUtNSAxLjQxLTEuNDFMMTAgMTQuMTdsNy41OS03LjU5TDE5IDhsLTkgOXoiLz4KPC9zdmc+Cg==">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIk1vbnRobHkgVHJhY2tlciIsCiAgInNob3J0X25hbWUiOiAiVHJhY2tlciIsCiAgImRlc2NyaXB0aW9uIjogIlRyYWNrIHlvdXIgaW5jb21lIGFuZCBleHBlbnNlcyBlZmZvcnRsZXNzbHkiLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiMzQjgyRjYiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0YVdSMGFEMGlNVGt5SWlCb1pXbG5hSFE5SWpFNU1pSWdkbWxsZDBKdmVEMGlNQ0F3SURFNU1pQXhPVElpSUdacGJHdzlJbTV2Ym1VaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJK0NqeHlaV04wSUhkcFpIUm9QU0l4T1RJaUlHaGxhV2RvZEQwaU1Ua3lJaUJ5ZUQwaU1qUWlJR1pwYkd3OUlpTXpRamczUmpZaUx6NEtQSE4yWnlCNFBTSTBPQ0lnZVQwaU5EZ2lJSGRwWkhSb1BTSTVOaUlnYUdWcFoyaDBQU0k1TmlJZ2RtbGxkMEp2ZUQwaU1DQXdJREkwSURJMElpQm1hV3hzUFNJalpsbVptWm1abUlqNEtJQ0E4Y0dGMGFDQmtQU0pOTVRJZ01rTTJMalE0SURJZ01pQTJMalE0SURJZ01USWdNeUE0TGpRNElERXdJREV3SURRdU5EZ2dNVEFnTVRBZ01UQmtMamc0SURFd0lERXdMVFF1TkRnZ01UQXRNVEJUTVRjdU5USWdNaUF4TWlBeWVtMHRNaUF4TldrdE5TMDFJREV1TkRFdE1TNDBNVXd4TUNBeE5DNHhObmczTGpVNUxUY3VOVTU4TVRrZ09HeHRPU0E1ZWlJdlBnbzhMM04yWno0SyI9IiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        .icon { width: 20px; height: 20px; display: inline-block; }
        .icon-lg { width: 32px; height: 32px; }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #3B82F6, #8B5CF6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .app-loaded .loading-screen {
            display: none;
        }

        .month-tab {
            transition: all 0.3s ease;
        }

        .month-tab:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="text-center">
            <div class="loading-spinner text-6xl mb-4">💰</div>
            <h1 class="text-2xl font-bold">Monthly Tracker</h1>
            <p class="text-blue-200">Loading your financial dashboard...</p>
        </div>
    </div>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Simple cloud sync simulation using a global object
        window.CloudSync = window.CloudSync || {
            data: {},
            users: {
                'admin': { password: 'admin123', name: 'Administrator', isAdmin: true },
                'arpbat': { password: 'arpitha7', name: 'Arpitha Battu' },
                'sarvesh': { password: 'sarvesh123', name: 'Sarvesh Kommawar' },
                'vanshika': { password: 'vanshika123', name: 'Vanshika Battu' }
            },
            
            // Save user data to cloud (organized by year and month)
            saveUserData: function(username, year, month, transactions) {
                if (!this.data[username]) this.data[username] = {};
                if (!this.data[username][year]) this.data[username][year] = {};
                this.data[username][year][month] = transactions;
                
                // Also save to localStorage as backup
                localStorage.setItem(`monthlyTracker_${username}_${year}_${month}`, JSON.stringify(transactions));
            },
            
            // Get user data from cloud (for specific year and month)
            getUserData: function(username, year, month) {
                // Try cloud first
                if (this.data[username] && this.data[username][year] && this.data[username][year][month]) {
                    return this.data[username][year][month];
                }
                
                // Then localStorage as fallback
                try {
                    const saved = localStorage.getItem(`monthlyTracker_${username}_${year}_${month}`);
                    const data = saved ? JSON.parse(saved) : [];
                    
                    // Sync to cloud
                    if (!this.data[username]) this.data[username] = {};
                    if (!this.data[username][year]) this.data[username][year] = {};
                    this.data[username][year][month] = data;
                    
                    return data;
                } catch (error) {
                    return [];
                }
            },

            // Get all data for a user (all years and months)
            getAllUserData: function(username) {
                const allData = {};
                const currentYear = new Date().getFullYear();
                
                // Load from cloud and localStorage
                for (let year = currentYear - 2; year <= currentYear + 1; year++) {
                    allData[year] = {};
                    for (let month = 0; month < 12; month++) {
                        const monthName = ['January', 'February', 'March', 'April', 'May', 'June',
                                         'July', 'August', 'September', 'October', 'November', 'December'][month];
                        allData[year][monthName] = this.getUserData(username, year, monthName);
                    }
                }
                
                return allData;
            },
            
            // Add new user
            addUser: function(username, password, name, isAdmin = false) {
                this.users[username] = { password, name, isAdmin };
                localStorage.setItem('userDatabase', JSON.stringify(this.users));
                return true;
            },
            
            // Load users from localStorage on app start
            loadUsers: function() {
                try {
                    const saved = localStorage.getItem('userDatabase');
                    if (saved) {
                        this.users = { ...this.users, ...JSON.parse(saved) };
                    }
                } catch (error) {
                    console.log('Error loading users from localStorage');
                }
            }
        };

        // Initialize cloud sync
        window.CloudSync.loadUsers();
        
        // Icon components
        const PlusCircle = () => (
            <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="16"></line>
                <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
        );

        const TrendingUp = () => (
            <svg className="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const TrendingDown = () => (
            <svg className="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline>
                <polyline points="17 18 23 18 23 12"></polyline>
            </svg>
        );

        const RupeeSign = () => (
            <svg className="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M6 3h12M6 8h12m-12 5a3 3 0 1 0 0-6m0 6a3 3 0 1 1 0 6M18 13l-8 8"/>
            </svg>
        );

        const Eye = () => (
            <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
            </svg>
        );

        const EyeOff = () => (
            <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
            </svg>
        );

        const Trash2 = () => (
            <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="3,6 5,6 21,6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const User = () => (
            <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        );

        const LogOut = () => (
            <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16,17 21,12 16,7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        );

        const UserPlus = () => (
            <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="20" y1="8" x2="20" y2="14"></line>
                <line x1="23" y1="11" x2="17" y2="11"></line>
            </svg>
        );

        const Calendar = () => (
            <svg className="icon-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const ChevronLeft = () => (
            <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="15,18 9,12 15,6"></polyline>
            </svg>
        );

        const ChevronRight = () => (
            <svg className="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="9,18 15,12 9,6"></polyline>
            </svg>
        );

        // Login Component
        const LoginForm = ({ onLogin }) => {
            const [loginData, setLoginData] = useState({ username: '', password: '' });
            const [error, setError] = useState('');

            const handleLogin = () => {
                const { username, password } = loginData;
                
                if (!username || !password) {
                    setError('Please enter both username and password');
                    return;
                }

                if (window.CloudSync.users[username] && window.CloudSync.users[username].password === password) {
                    onLogin(username, window.CloudSync.users[username].name, window.CloudSync.users[username].isAdmin || false);
                    setError('');
                } else {
                    setError('Invalid username or password');
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                        <div className="text-center mb-8">
                            <div className="text-6xl mb-4">💰</div>
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Monthly Tracker</h1>
                            <p className="text-gray-600">Sign in to access your financial data</p>
                        </div>

                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Username</label>
                                <input
                                    type="text"
                                    value={loginData.username}
                                    onChange={(e) => setLoginData({...loginData, username: e.target.value})}
                                    onKeyPress={handleKeyPress}
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Enter username"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input
                                    type="password"
                                    value={loginData.password}
                                    onChange={(e) => setLoginData({...loginData, password: e.target.value})}
                                    onKeyPress={handleKeyPress}
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Enter password"
                                />
                            </div>

                            {error && (
                                <div className="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg">
                                    {error}
                                </div>
                            )}

                            <button
                                onClick={handleLogin}
                                className="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 px-4 rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200 font-semibold"
                            >
                                Sign In
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Add User Form Component (Admin Only)
        const AddUserForm = ({ onAddUser, onClose }) => {
            const [userData, setUserData] = useState({
                username: '',
                password: '',
                name: '',
                isAdmin: false
            });
            const [error, setError] = useState('');

            const handleSubmit = () => {
                const { username, password, name } = userData;
                
                if (!username || !password || !name) {
                    setError('Please fill all required fields');
                    return;
                }

                if (window.CloudSync.users[username]) {
                    setError('Username already exists');
                    return;
                }

                if (username.length < 3) {
                    setError('Username must be at least 3 characters');
                    return;
                }

                if (password.length < 6) {
                    setError('Password must be at least 6 characters');
                    return;
                }

                window.CloudSync.addUser(username, password, name, userData.isAdmin);
                onAddUser();
                onClose();
                setError('');
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md">
                        <h3 className="text-xl font-bold text-gray-800 mb-4">Add New User</h3>
                        
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                                <input
                                    type="text"
                                    value={userData.name}
                                    onChange={(e) => setUserData({...userData, name: e.target.value})}
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Enter full name"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Username *</label>
                                <input
                                    type="text"
                                    value={userData.username}
                                    onChange={(e) => setUserData({...userData, username: e.target.value.toLowerCase()})}
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Enter username (min 3 chars)"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Password *</label>
                                <input
                                    type="password"
                                    value={userData.password}
                                    onChange={(e) => setUserData({...userData, password: e.target.value})}
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Enter password (min 6 chars)"
                                />
                            </div>

                            <div className="flex items-center">
                                <input
                                    type="checkbox"
                                    id="isAdmin"
                                    checked={userData.isAdmin}
                                    onChange={(e) => setUserData({...userData, isAdmin: e.target.checked})}
                                    className="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                                />
                                <label htmlFor="isAdmin" className="ml-2 block text-sm text-gray-700">
                                    Make this user an admin
                                </label>
                            </div>

                            {error && (
                                <div className="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg text-sm">
                                    {error}
                                </div>
                            )}

                            <div className="flex gap-3">
                                <button
                                    onClick={handleSubmit}
                                    className="flex-1 bg-gradient-to-r from-green-500 to-blue-600 text-white py-3 px-4 rounded-lg hover:from-green-600 hover:to-blue-700 transition-all duration-200 font-semibold"
                                >
                                    Add User
                                </button>
                                <button
                                    onClick={onClose}
                                    className="flex-1 bg-gray-500 text-white py-3 px-4 rounded-lg hover:bg-gray-600 transition-all duration-200 font-semibold"
                                >
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Main Tracker Component
        const MonthlyTracker = ({ currentUser, userName, isAdmin, onLogout }) => {
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonthIndex = currentDate.getMonth();
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            const [selectedYear, setSelectedYear] = useState(currentYear);
            const [selectedMonth, setSelectedMonth] = useState(monthNames[currentMonthIndex]);
            const [transactions, setTransactions] = useState(() => 
                window.CloudSync.getUserData(currentUser, selectedYear, selectedMonth)
            );
            const [showForm, setShowForm] = useState(false);
            const [formData, setFormData] = useState({
                type: 'expense',
                category: '',
                amount: '',
                description: '',
                date: new Date().toISOString().split('T')[0]
            });
            const [showBalance, setShowBalance] = useState(true);
            const [showCredentials, setShowCredentials] = useState(false);
            const [showAddUser, setShowAddUser] = useState(false);
            const [userRefresh, setUserRefresh] = useState(0);

            // Load transactions when month/year changes
            useEffect(() => {
                const monthTransactions = window.CloudSync.getUserData(currentUser, selectedYear, selectedMonth);
                setTransactions(monthTransactions);
            }, [currentUser, selectedYear, selectedMonth]);

            // Save data whenever transactions change
            useEffect(() => {
                window.CloudSync.saveUserData(currentUser, selectedYear, selectedMonth, transactions);
            }, [transactions, currentUser, selectedYear, selectedMonth]);

            const incomeCategories = [
                'Salary/Wages', 'Freelance', 'Business Income', 'Investment Returns', 
                'Rental Income', 'Side Hustle', 'Gifts/Bonus', 'Other Income'
            ];

            const expenseCategories = [
                'Housing', 'Transportation', 'Food & Dining', 'Utilities', 'Healthcare',
                'Insurance', 'Shopping', 'Entertainment', 'Education', 'Personal Care',
                'Travel', 'Subscriptions', 'Debt Payments', 'Savings', 'Taxes', 'Other Expenses'
            ];

            const categoryIcons = {
                'Salary/Wages': '💼', 'Freelance': '💻', 'Business Income': '🏢', 'Investment Returns': '📈',
                'Rental Income': '🏠', 'Side Hustle': '🚀', 'Gifts/Bonus': '🎁', 'Other Income': '💰',
                'Housing': '🏠', 'Transportation': '🚗', 'Food & Dining': '🍽️', 'Utilities': '⚡',
                'Healthcare': '🏥', 'Insurance': '🛡️', 'Shopping': '🛍️', 'Entertainment': '🎬',
                'Education': '📚', 'Personal Care': '💅', 'Travel': '✈️', 'Subscriptions': '📱',
                'Debt Payments': '💳', 'Savings': '🐷', 'Taxes': '📋', 'Other Expenses': '📦'
            };

            const monthEmojis = {
                'January': '❄️', 'February': '💝', 'March': '🌸', 'April': '🌱',
                'May': '🌷', 'June': '☀️', 'July': '🏖️', 'August': '🌻',
                'September': '🍂', 'October': '🎃', 'November': '🦃', 'December': '🎄'
            };

            const handleSubmit = () => {
                if (!formData.category || !formData.amount) return;

                const newTransaction = {
                    id: Date.now(),
                    ...formData,
                    amount: parseFloat(formData.amount),
                    date: formData.date
                };

                setTransactions([newTransaction, ...transactions]);
                setFormData({
                    type: 'expense',
                    category: '',
                    amount: '',
                    description: '',
                    date: new Date().toISOString().split('T')[0]
                });
                setShowForm(false);
            };

            const deleteTransaction = (id) => {
                setTransactions(transactions.filter(t => t.id !== id));
            };

            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);

            const totalExpenses = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);

            const balance = totalIncome - totalExpenses;

            const getCategoryTotals = (type) => {
                const categories = type === 'income' ? incomeCategories : expenseCategories;
                return categories.map(category => {
                    const categoryTransactions = transactions.filter(t => t.type === type && t.category === category);
                    const total = categoryTransactions.reduce((sum, t) => sum + t.amount, 0);
                    return { category, total, count: categoryTransactions.length };
                }).filter(c => c.total > 0);
            };

            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('en-IN', {
                    style: 'currency',
                    currency: 'INR'
                }).format(amount);
            };

            const handleAddUser = () => {
                setUserRefresh(prev => prev + 1);
            };

            const changeMonth = (direction) => {
                const currentIndex = monthNames.indexOf(selectedMonth);
                let newIndex, newYear = selectedYear;
                
                if (direction === 'prev') {
                    newIndex = currentIndex - 1;
                    if (newIndex < 0) {
                        newIndex = 11;
                        newYear = selectedYear - 1;
                    }
                } else {
                    newIndex = currentIndex + 1;
                    if (newIndex > 11) {
                        newIndex = 0;
                        newYear = selectedYear + 1;
                    }
                }
                
                setSelectedMonth(monthNames[newIndex]);
                setSelectedYear(newYear);
            };

            const getMonthSummary = (monthName) => {
                const monthData = window.CloudSync.getUserData(currentUser, selectedYear, monthName);
                const income = monthData.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                const expenses = monthData.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                return { income, expenses, balance: income - expenses, transactions: monthData.length };
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                    <div className="max-w-7xl mx-auto">
                        {/* Header with User Info */}
                        <div className="text-center mb-8">
                            <div className="flex justify-between items-center mb-4">
                                <div className="flex items-center gap-2 text-gray-600">
                                    <User />
                                    <span>Welcome, {userName} {isAdmin && '(Admin)'}</span>
                                </div>
                                <div className="flex items-center gap-4">
                                    {isAdmin && (
                                        <>
                                            <button
                                                onClick={() => setShowAddUser(true)}
                                                className="flex items-center gap-2 text-green-600 hover:text-green-800 transition-colors text-sm"
                                            >
                                                <UserPlus />
                                                <span>Add User</span>
                                            </button>
                                            <button
                                                onClick={() => setShowCredentials(!showCredentials)}
                                                className="flex items-center gap-2 text-blue-600 hover:text-blue-800 transition-colors text-sm"
                                            >
                                                <Eye />
                                                <span>{showCredentials ? 'Hide' : 'Show'} Users</span>
                                            </button>
                                        </>
                                    )}
                                    <button
                                        onClick={onLogout}
                                        className="flex items-center gap-2 text-red-600 hover:text-red-800 transition-colors"
                                    >
                                        <LogOut />
                                        <span>Logout</span>
                                    </button>
                                </div>
                            </div>
                            
                            {/* Admin Credentials Panel */}
                            {isAdmin && showCredentials && (
                                <div className="bg-white rounded-xl shadow-lg p-6 mb-6 border-l-4 border-blue-500">
                                    <h3 className="text-lg font-semibold text-gray-800 mb-4">User Management (Admin View)</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-left">
                                        {Object.entries(window.CloudSync.users).map(([username, user]) => (
                                            <div key={username} className="bg-gray-50 p-3 rounded-lg">
                                                <p className="font-medium text-gray-800">{user.name}</p>
                                                <p className="text-sm text-gray-600">Username: <span className="font-mono">{username}</span></p>
                                                <p className="text-sm text-gray-600">Password: <span className="font-mono">{user.password}</span></p>
                                                {user.isAdmin && <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Admin</span>}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                            
                            <h1 className="text-4xl font-bold text-gray-800 mb-2">Monthly Tracker</h1>
                            <p className="text-gray-600">Track your income and expenses month by month</p>
                        </div>

                        {/* Add User Modal */}
                        {showAddUser && (
                            <AddUserForm 
                                onAddUser={handleAddUser}
                                onClose={() => setShowAddUser(false)}
                            />
                        )}

                        {/* Year and Month Selector */}
                        <div className="bg-white rounded-xl shadow-lg p-6 mb-8">
                            <div className="flex items-center justify-between mb-6">
                                <button
                                    onClick={() => changeMonth('prev')}
                                    className="flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                                >
                                    <ChevronLeft />
                                    <span>Previous</span>
                                </button>
                                
                                <div className="text-center">
                                    <div className="text-3xl font-bold text-gray-800 flex items-center gap-2 justify-center">
                                        <span>{monthEmojis[selectedMonth]}</span>
                                        <span>{selectedMonth} {selectedYear}</span>
                                        <Calendar />
                                    </div>
                                </div>
                                
                                <button
                                    onClick={() => changeMonth('next')}
                                    className="flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                                >
                                    <span>Next</span>
                                    <ChevronRight />
                                </button>
                            </div>

                            {/* Month Overview Grid */}
                            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
                                {monthNames.map((month) => {
                                    const summary = getMonthSummary(month);
                                    const isSelected = month === selectedMonth;
                                    const hasData = summary.transactions > 0;
                                    
                                    return (
                                        <button
                                            key={month}
                                            onClick={() => setSelectedMonth(month)}
                                            className={`month-tab p-3 rounded-lg text-center transition-all ${
                                                isSelected 
                                                    ? 'bg-blue-500 text-white shadow-lg' 
                                                    : hasData 
                                                        ? 'bg-green-100 hover:bg-green-200 text-green-800'
                                                        : 'bg-gray-100 hover:bg-gray-200 text-gray-600'
                                            }`}
                                        >
                                            <div className="text-lg mb-1">{monthEmojis[month]}</div>
                                            <div className="text-xs font-medium">{month.slice(0, 3)}</div>
                                            {hasData && (
                                                <div className="text-xs mt-1">
                                                    <div>{summary.transactions} txns</div>
                                                    <div className={summary.balance >= 0 ? 'text-green-600' : 'text-red-600'}>
                                                        {isSelected ? (summary.balance >= 0 ? '+' : '') + formatCurrency(summary.balance).slice(1) : '●'}
                                                    </div>
                                                </div>
                                            )}
                                        </button>
                                    );
                                })}
                            </div>
                        </div>

                        {/* Summary Cards for Selected Month */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-600 mb-1">Income ({selectedMonth})</p>
                                        <p className="text-2xl font-bold text-green-600">{formatCurrency(totalIncome)}</p>
                                    </div>
                                    <TrendingUp />
                                </div>
                            </div>

                            <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-red-500">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-600 mb-1">Expenses ({selectedMonth})</p>
                                        <p className="text-2xl font-bold text-red-600">{formatCurrency(totalExpenses)}</p>
                                    </div>
                                    <TrendingDown />
                                </div>
                            </div>

                            <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-600 mb-1">Net Balance ({selectedMonth})</p>
                                        <div className="flex items-center gap-2">
                                            <p className={`text-2xl font-bold ${balance >= 0 ? 'text-blue-600' : 'text-red-600'}`}>
                                                {showBalance ? formatCurrency(balance) : '****'}
                                            </p>
                                            <button
                                                onClick={() => setShowBalance(!showBalance)}
                                                className="text-gray-400 hover:text-gray-600"
                                            >
                                                {showBalance ? <EyeOff /> : <Eye />}
                                            </button>
                                        </div>
                                    </div>
                                    <RupeeSign />
                                </div>
                            </div>

                            <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-600 mb-1">Transactions ({selectedMonth})</p>
                                        <p className="text-2xl font-bold text-purple-600">{transactions.length}</p>
                                    </div>
                                    <div className="text-purple-500 text-4xl">📊</div>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Add Transaction Form */}
                            <div className="lg:col-span-1">
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <button
                                        onClick={() => setShowForm(!showForm)}
                                        className="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 px-4 rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200 font-semibold"
                                    >
                                        <PlusCircle />
                                        Add Transaction to {selectedMonth}
                                    </button>

                                    {showForm && (
                                        <div className="mt-6 space-y-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Type</label>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => setFormData({...formData, type: 'income', category: ''})}
                                                        className={`flex-1 py-2 px-4 rounded-lg font-medium transition-all ${
                                                            formData.type === 'income'
                                                                ? 'bg-green-500 text-white'
                                                                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                        }`}
                                                    >
                                                        Income
                                                    </button>
                                                    <button
                                                        onClick={() => setFormData({...formData, type: 'expense', category: ''})}
                                                        className={`flex-1 py-2 px-4 rounded-lg font-medium transition-all ${
                                                            formData.type === 'expense'
                                                                ? 'bg-red-500 text-white'
                                                                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                        }`}
                                                    >
                                                        Expense
                                                    </button>
                                                </div>
                                            </div>

                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Category</label>
                                                <select
                                                    value={formData.category}
                                                    onChange={(e) => setFormData({...formData, category: e.target.value})}
                                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                >
                                                    <option value="">Select category</option>
                                                    {(formData.type === 'income' ? incomeCategories : expenseCategories).map(cat => (
                                                        <option key={cat} value={cat}>{categoryIcons[cat]} {cat}</option>
                                                    ))}
                                                </select>
                                            </div>

                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Amount (₹)</label>
                                                <input
                                                    type="number"
                                                    step="0.01"
                                                    value={formData.amount}
                                                    onChange={(e) => setFormData({...formData, amount: e.target.value})}
                                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    placeholder="0.00"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                                <input
                                                    type="text"
                                                    value={formData.description}
                                                    onChange={(e) => setFormData({...formData, description: e.target.value})}
                                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    placeholder="Optional description"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Date</label>
                                                <input
                                                    type="date"
                                                    value={formData.date}
                                                    onChange={(e) => setFormData({...formData, date: e.target.value})}
                                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                />
                                            </div>

                                            <button
                                                onClick={handleSubmit}
                                                className="w-full bg-gradient-to-r from-green-500 to-blue-600 text-white py-3 px-4 rounded-lg hover:from-green-600 hover:to-blue-700 transition-all duration-200 font-semibold"
                                            >
                                                Add to {selectedMonth} {selectedYear}
                                            </button>
                                        </div>
                                    )}
                                </div>

                                {/* Category Summaries for Selected Month */}
                                <div className="mt-6 bg-white rounded-xl shadow-lg p-6">
                                    <h3 className="text-lg font-semibold text-gray-800 mb-4">
                                        {selectedMonth} Category Breakdown
                                    </h3>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <h4 className="font-medium text-green-600 mb-2">Income Categories</h4>
                                            <div className="space-y-2">
                                                {getCategoryTotals('income').map(({category, total}) => (
                                                    <div key={category} className="flex justify-between items-center">
                                                        <span className="text-sm text-gray-600">{categoryIcons[category]} {category}</span>
                                                        <span className="font-medium text-green-600">{formatCurrency(total)}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        <div>
                                            <h4 className="font-medium text-red-600 mb-2">Expense Categories</h4>
                                            <div className="space-y-2">
                                                {getCategoryTotals('expense').map(({category, total}) => (
                                                    <div key={category} className="flex justify-between items-center">
                                                        <span className="text-sm text-gray-600">{categoryIcons[category]} {category}</span>
                                                        <span className="font-medium text-red-600">{formatCurrency(total)}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Transaction History for Selected Month */}
                            <div className="lg:col-span-2">
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h3 className="text-lg font-semibold text-gray-800 mb-4">
                                        {selectedMonth} {selectedYear} Transactions
                                    </h3>
                                    
                                    {transactions.length === 0 ? (
                                        <div className="text-center py-12 text-gray-500">
                                            <div className="text-4xl mb-2">{monthEmojis[selectedMonth]}</div>
                                            <p>No transactions for {selectedMonth} yet.</p>
                                            <p className="text-sm mt-2">Add your first transaction to get started!</p>
                                        </div>
                                    ) : (
                                        <div className="space-y-3 max-h-96 overflow-y-auto">
                                            {transactions.map(transaction => (
                                                <div
                                                    key={transaction.id}
                                                    className={`flex items-center justify-between p-4 rounded-lg border-l-4 ${
                                                        transaction.type === 'income' 
                                                            ? 'bg-green-50 border-green-500' 
                                                            : 'bg-red-50 border-red-500'
                                                    }`}
                                                >
                                                    <div className="flex items-center gap-3">
                                                        <div className="text-2xl">
                                                            {categoryIcons[transaction.category]}
                                                        </div>
                                                        <div>
                                                            <p className="font-medium text-gray-800">{transaction.category}</p>
                                                            {transaction.description && (
                                                                <p className="text-sm text-gray-600">{transaction.description}</p>
                                                            )}
                                                            <p className="text-xs text-gray-500">{transaction.date}</p>
                                                        </div>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <span className={`font-bold ${
                                                            transaction.type === 'income' ? 'text-green-600' : 'text-red-600'
                                                        }`}>
                                                            {transaction.type === 'income' ? '+' : '-'}{formatCurrency(transaction.amount)}
                                                        </span>
                                                        <button
                                                            onClick={() => deleteTransaction(transaction.id)}
                                                            className="text-red-400 hover:text-red-600 p-1"
                                                        >
                                                            <Trash2 />
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [userName, setUserName] = useState('');
            const [isAdmin, setIsAdmin] = useState(false);

            // Check if user is already logged in
            useEffect(() => {
                const savedUser = localStorage.getItem('currentUser');
                const savedUserName = localStorage.getItem('currentUserName');
                const savedIsAdmin = localStorage.getItem('currentIsAdmin') === 'true';
                if (savedUser && savedUserName) {
                    setCurrentUser(savedUser);
                    setUserName(savedUserName);
                    setIsAdmin(savedIsAdmin);
                }
            }, []);

            const handleLogin = (username, name, adminStatus) => {
                setCurrentUser(username);
                setUserName(name);
                setIsAdmin(adminStatus);
                localStorage.setItem('currentUser', username);
                localStorage.setItem('currentUserName', name);
                localStorage.setItem('currentIsAdmin', adminStatus.toString());
            };

            const handleLogout = () => {
                setCurrentUser(null);
                setUserName('');
                setIsAdmin(false);
                localStorage.removeItem('currentUser');
                localStorage.removeItem('currentUserName');
                localStorage.removeItem('currentIsAdmin');
            };

            if (!currentUser) {
                return <LoginForm onLogin={handleLogin} />;
            }

            return (
                <MonthlyTracker 
                    currentUser={currentUser} 
                    userName={userName} 
                    isAdmin={isAdmin}
                    onLogout={handleLogout} 
                />
            );
        };

        // Hide loading screen and render app
        setTimeout(() => {
            document.body.classList.add('app-loaded');
            ReactDOM.render(<App />, document.getElementById('root'));
        }, 1500);

        // Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'monthly-tracker-v4';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>
